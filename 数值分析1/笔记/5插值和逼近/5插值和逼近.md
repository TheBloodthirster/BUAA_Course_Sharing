# 插值和逼近

本章介绍插值与逼近，即寻找某个逼近复杂函数$f(x)$的简单函数$p(x)$。

## 代数插值

代数插值共介绍了三种插值方法：**范德蒙矩阵方法**、**拉格朗日插值方法**、**牛顿插值方法**。三种插值方法代码实践写在了`Interpolation.py`中。其中范德蒙矩阵方法是最直接但计算量最大的方法，但是需要求解一组n次的线性方程组，n为插值点个数。拉格朗日插值方法易于理解，包括拉格朗日基+各个基对应的函数值，可以参考视频：[B站轩兔](https://www.bilibili.com/video/BV1fL4y1T7fL/)，但是其缺陷在于若需要额外添加一个新的插值项，则需要重新计算所有的拉格朗日基。牛顿法避免了拉格朗日法的问题，需要通过函数的n阶差商作为系数，和牛顿基的形式完成插值。

### 范德蒙矩阵方法

给定$n+1$个插值点$(x_i,y_i = f(x_i))$，构造$n$次插值多项式$p_n(x)$逼近$f(x)$:

$$
p_n(x)=a_0 + a_1x + a_2x^2 + \cdots a_nx^n
$$

那么可以构建$n+1$个线性方程组：

$$
a_0 + a_1x_0 + \cdots + a_nx_0^n = y_0 \\
a_0 + a_1x_1 + \cdots + a_nx_1^n = y_1 \\
\vdots\\
a_0 + a_1x_n + \cdots + a_nx_n^n = y_n \\
$$

通过求解上述线性方程组，从而确定系数$a_0 \cdots a_n$，从而构造$p_n(x)$的方法即为范德蒙矩阵方法。

### 拉格朗日插值法

拉格朗日插值法定义下述插值多项式$p_n(x)$:

$$
p_n(x)=\sum_{k=0}^n l_k(x)f(x_k)
$$

其中$l_k(x)$称为拉格朗日Lagrange基函数，其表达形式为：

$$
l_k(x_i) =
\begin{cases}
1, & i = k \\
0, & i \neq k
\end{cases}
$$

即除了插值的点$x_k$外，其与的插值点都为零的光滑函数，这个基函数可这样构造：

$$
\prod_{j=0, j\ne k}^n \frac{x-x_j}{x_k-x_j}
$$

上述即为拉格朗日插值法。

### 牛顿插值法

牛顿插值法的多项式有以下的形式，这样的好处是多一个额外的插值点可以在原有的基础上增加一项，而不需要推倒重来：

$$
P_n(x)=a_0\omega_0(x)+a_1\omega_1(x)+\cdots +a_n\omega_n(x)=\sum_{i=0}^n a_i\omega_i(x)
$$

其中$\omega_i(x)$为牛顿插值基函数，有：

$$
\begin{cases}
\omega_0 = 1 \\
\omega_n = (x-x_0)(x-x_1)\cdots(x-x_{n-1}) = \prod_{j=0}^{n-1}(x-x_j)
\end{cases}
$$

式中的$a_i$为牛顿插值法的系数，通过差商的方法定义：

$$
\begin{cases}
a_0 = f(x_0)\\
a_k = f[x_0 \cdots x_k]
\end{cases}
$$

其中差商的定义：
$$
f[x_0,x_1] = \frac{f(x_1)-f(x_0)}{x_1-x_0}\\
$$
$$
f[x_0,\cdots,x_k] = \frac{f[x_0,\cdots,x_{k-2},x_k]-f[x_0,\cdots,x_k]}{x_k-x_{k-1}}
$$

### 三种插值余项

对于一个插值函数，其余项定义为$R_n(x)=f(x)-P_n(x)$

**拉格朗日余项**

这是由**罗尔定理**直接推算得到的形式，但是需要知道具体函数的形式并进行求导，在这里，$\xi$ 是插值区间内的未知点：

\[R_n(x)=\frac{f^{(n+1)}(\xi)}{(n+1)!}\cdot\omega_{n+1}(x)\]

**牛顿余项**

若没有具体的函数或不可导，可以使用牛顿余项的差商形式表示：

\[R_n(x)=f[x_0,x_1,...,x_n,x]\cdot\omega_{n+1}(x)\]

**后验估计余项**

上述的情况必须要求知道函数的一些具体的信息，若只有某个未知函数的离散数据，我们可以在完成插值后，考虑替换或加密（变密集）原先的节点，得到新的某个节点$\tilde{x}_n$,然后重新进行插值得到$\tilde{P}_n(x)$:

\[R_n(x)=\frac{x-x_n}{x-\tilde{x}_n}(P_n(x)-\tilde{P}_n(x))\]

这个式子可以由拉格朗日余项简单推导得到，并考虑$\tilde{P}_n$和$P_n$的导数相同。

### 分段低次插值

在实际工程中，计算大量的n个节点构成的函数计算量较大，可以将原函数分段，然后使用例如二次低次插值等方法。分段低次插值获得了收敛性，但损失了光滑性。

## Hermite插值

给定$n+1$个节点 $x_0 \cdots x_i$，并给定$m$个导数信息，构建不高于$m+n+1$的多项式：

$$
H(x)=\sum_{j=0}^{m+n+1}a_jx^j
$$

使其能够满足：

$$
\begin{cases}
H(x_i)=y_i\\
H'(x_{i_k})=y'_{i_k}
\end{cases}
$$

上述即为Hermite多项式。

为了构造Hermite多项式，可以先用代数插值的方法求出满足函数位置条件的$p_n(x)$，然后这样构造：

$$
H(x)=p_n(x)+q_m(x)\omega_{n+1}(x)
$$

为了补充函数的导数信息，可以补充对上式求导，整理可以发现：

$$
q_m(x_{j_k}) = \frac{y'_{j_k}-p_n'(x_{j_k})}{\omega'_{n+1}(x_{j_k})}
$$

对于Hermite多项式的误差估计，有：

$$
R(x)=\frac{f^{(n+m+2)}(\epsilon)}{(n+m+2)!}\omega_{n+1}(x)\prod_{k=0}^m(x-x_{i_k})
$$

## 正交多项式

### 基本概念

**权函数**

对于区间$(a,b)$上的非负连续函数$f(x)$，若

$$
\int_a^b \rho (x)f(x)dx=0
$$

则在$(a,b)$上$f(x) \equiv 0$，$\rho(x)$即为区间上的权函数。

**内积**

$$
(f,g)=\int_a^b \rho(x)f(x)g(x)dx
$$

为函数$f(x)$于$g(x)$在$[a,b]$上的内积。

**正交多项式系**

若 $(f,g)=0$，则称$f(x)$与$g(x)$在区间$[a,b]$上带权正交。

若函数系$\{\phi_0,\phi_1,\cdots,\phi_n\}$满足:

$$
(\phi_i,\phi_j) = \begin{cases}
0, i\ne j\\
a_i>0, i=j
\end{cases}
$$

则称$\{\phi_k(x)\}$为$[a,b]$上带权$\rho(x)$的正交函数系。

### 常用的正交多项式系

勒让德Legendre多项式，在区间$[-1,1]$上正交：

$$
\begin{cases}
    L_0(x)=1\\
    L_n(x)=\frac{1}{2^nn!}\cdot\frac{d^n}{dx^n}[(x^2-1)^n]
\end{cases}
$$

注：学习轨道力学的非球形引力摄动中使用到了连带勒让德函数，其表达式为：

$$
L_n^m(x) = (1 - x^2)^{\frac{m}{2}} \cdot \frac{d^m}{dx^m} P_n(x)
$$

这是上述勒让德多项式的一个拓展，即$m=0$时，$L_n^m(x)=L_n(x)$。

## 函数的最佳平方逼近

本节的概念与最小二乘法类似，不过用内积来定义最佳平方逼近元素，使用连续的函数$p(x)$逼近另外一个复杂的连续函数$f(x)$：

给定一组函数组作为基底，并张成线性空间$H_n=\text{Span}\{\phi_0,\phi_1,\cdots \phi_i\}$

$$
(f-p^*,f-p^*)=\min_{p\in H_n}(f-p,f-p)
$$

则称$p^*(x)$为子空间$H_n$中对$f(x)$的最佳平方逼近元素。

为了求解$p^*(x)$对上述变型可以得到：

$$
p^*(x)=\sum_{k=0}^nc_k^*(\phi_k,\phi_j)=(f,\phi_j)
$$

而我们实际上就要求解的即为上述式子中所有的$c_k^*$系数。

### 正则方程求解最佳平方逼近

以书中的例题为例，求解$H_1 = \text{Span}\{1,x\}$中对于$f(x)=\sqrt{x}$的最佳平方逼近元素$p(x)$:

首先给出了这里的内积的定义方式：

$$
(f,g)=\int_0^1f(x)g(x)dx
$$

然后求解所有项的内积：

 <img src="LS1.png" width="500" />

最后形成一个这样的线性方程组：

$$
\begin{bmatrix}
    (\phi_0,\phi_0)&(\phi_1,\phi_0)\\
    (\phi_0,\phi_1)&(\phi_1,\phi_1)
\end{bmatrix} 
\begin{bmatrix}
    c_0 \\c_1
\end{bmatrix}=
\begin{bmatrix}
    (\phi_0,f)\\(\phi_1,f)
\end{bmatrix}
$$

代入上述数字可以解得：$c_0=4/15,c_1=4/5$,因此：

$$
p^*(x)=c_0\phi_0 + c_1\phi_1 = \frac{4}{15}+\frac{4}{5}x
$$

### 利用正交函数系求解最佳平方逼近

在使用正则方法求解上述方程式若方程组较大则会病态，因此可以利用**正交函数系**求解最佳平方逼近避免这个问题。

以使用勒让德多项式求解为例，此时最佳平方逼近的系数可直接这样求解得到：

$$
c_k^* = \frac{(f,L_k)}{L_k,L_k}
$$

若给定的求解区间为一般的$[a,b]$而非$[-1,1]$,可以这样转化：

$$
x = \frac{a+b}{2}+\frac{b-a}{2}t
$$

### 最小二乘法补充
先前学习过最小二乘法的一般表达式：

假设给定一组离散的观测值$\hat{\mathbf{y}}_{t\times n}$，需要使用函数$\mathbf{Ax}$逼近。其中$\mathbf{A}_{t\times p}$为基构成的矩阵，我们需要求解系数矩阵$\mathbf{x}_{p\times n}$完成最小二乘法，即：

$$
\min_\mathbf{x} ||\hat{\mathbf{y}}-\mathbf{Ax}||
$$

若$\mathbf{A}$不为方阵，为了求解$\mathbf{x}$,需要用到伪逆的方法求解，注意这里需要满足矩阵$\mathbf{A}$满秩：

$$
\mathbf{x}=\mathbf{A}^{\times}\hat{\mathbf{y}}=[(\mathbf{A}^T\mathbf{A})^{-1}\mathbf{A}^T]\space\hat{\mathbf{y}}
$$

实际上这个表达式也可写成：

$$
\mathbf{A^TAx=A\hat{y}}
$$

在部分情况下解题比较方便。
