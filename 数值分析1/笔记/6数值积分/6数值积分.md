# 数值积分

数值方法求积分的一般形式为：

$$
\int_a^b f(x)dx \approx \sum_{k=0}^n \lambda_kf(x_k)
$$

- $x_k$为$[a,b]$区间内$n$个**求积节点**
- $\lambda_k$称为**求积系数**，与积分函数$f(x)$无关

可简单定义数值积分的**截断误差**，即准确值减积分值：

$$
R_n = \int_a^b f(x)dx - \sum_{k=0}^n \lambda_kf(x_k)
$$

**代数精度**：若上述截断误差公式中，积分公式对$m$次多项式都成立，使之消为0,对$m+1$次多项式不成立，产生余项，那么称其有$m$次代数精度。

以教材中这道题为例：

> 判断下述数值积分方法的代数精度：
> $$
> \int_{-1}^1f(x)dx = \frac{1}{2}[f(-1)+2f(0)+f(1)]
> $$
>
> <img src= Problem1.png width=500>

## 插值型求积公式

### 一般的拉格朗日插值积分

若对函数$f(x)$求解拉格朗日插值，然后积分，即：

构造$p_n(x)$近似于$f(x)$:

$$
p_n(x)=\sum_{k=0}^nl_k(x)f(x_k)
$$

然后求解积分：

$$
\int_a^b f(x)dx = \int_a^b p_n(x)dx = \int_a^b \sum_{k=0}^nl_k(x)f(x_k) dx
$$

上述即为**插值型求积公式**，由于积分和求和符可互换位置，可以看出：

$$
\int_a^b f(x)dx =\sum_{k=0}^n \lambda_kf(x_k) = \sum_{k=0}^n \int_a^b l_k(x)dx \cdot f(x_k) 
$$

$$
\lambda_k = \int_a^b l_k(x)dx
$$

对于上述插值型求积公式，**若有$n+1$个节点，那么有$n$次代数精度。**

### 均匀的Newton-Cotes积分

若**积分节点均匀分布**，满足：

$$
x_k = a+kh = a+k\cdot\frac{b-a}{n}
$$

那么对应的积分公式称为Newton-Cotes积分公式。

对于Newton-Cotes积分公式，**若有$n$个节点，$n$为奇数，那么积分公式有$n$次代数精度，比一般的插值形公式提高一次精度**。

常见的Newton-Cotes积分有：**梯形公式**，**Simpson公式**

**梯形公式**：2个插值点($x_0=a,x_1=b$)，1次代数精度
$$
\int_a^b f(x)dx \approx \frac{b-a}{2}[f(a)+f(b)]
$$

**Simpson公式**：3个插值点($x_0=a,x_1=\frac{a+b}{2},x_2=b$)，**3次代数精度**
$$
\int_a^b f(x)dx \approx \frac{b-a}{6}[f(a)+4f(\frac{a+b}{2})+f(b)]
$$

### 积分收敛性问题

记$I_n(f)$为数值方法求解积分，$I(f)$为精确积分，若：

$$
\lim_{n\rightarrow\infty}I_n(f)=I(f)
$$

则称积分公式为收敛的。

然而上述的收敛表达式中，$I(f)$不容易得到，因此考虑每次积分时$f(x_k)=f(x_k)+\epsilon_k$产生的数值误差：

$$
\eta_n = \sum_{k=0}^n \lambda_k \epsilon_k
$$

对上述表达式进行分析，发现只要满足对于常数$K$：

$$
\sum_{k=0}^n|\lambda_k|\le K 
$$

积分公式即具有数值稳定性。分析发现先前的所有插值型求积公式稳定性无保障，有两种获得稳定和数值积分方法：**复化积分法**和**Gauss积分法**。


## 复化求积公式

**复化求积公式的核心概念是将区间分为多个小区间，在每个小区间内使用上述的梯形或Simpson求积公式计算，这样得到的最终结果能够保证数值收敛。**

设$[a,b]$区间内存在$n+1$个均匀分布的节点：

$$
x_k = a+kh = a+k\cdot\frac{b-a}{n}; \quad k = 0,1,\cdots,n
$$

**梯形复化求积公式**

使用梯形复化求积公式，需要满足$f(x)$在区间上满足**两阶**连续可导。

$$
\int_a^b f(x)dx \approx \frac{h}{2}[f(a)+f(b)+2\sum_{k=1}^{n-1}f(a+kh)]
$$

梯形复化求积的值序列是**二阶收敛**的。

**Simpson复化求积公式**

使用Simpson复化求积公式，需要满足$f(x)$在区间上满足**四阶**连续可导。

$$
\int_a^b f(x)dx \approx \frac{h}{3}[f(a)+f(b)+4\sum_{i=1}^{m}f(x_{2i-1})+2\sum_{i=1}^{m-1}f(x_{2i})]
$$

注意求和的两项分别为奇数节点项和偶数节点项。Simpson的值序列是**四阶收敛**的。

**为了达到相同的精度条件，使用梯形复化求积比Simpson方法需要更多的节点，更大的计算量。**

下图展示了一个梯形复化求积法与Simpson积分方法的可视化对比，代码在`Integral.py`中。

<img src = "Integral.png" width = 600 />

## Gauss型求积公式

### 基本概念

Gauss型求积公式构造复杂，但是是具有**最高代数精度**的。经证明，给定$n$个节点，最高只能构造$2n-1$代数精度的求积公式。若求积分公式有$2n-1$代数精度，称其为Gauss型求积公式。
*【经LLM和课本交叉验证，PPT中给出的 $2n+1$的结论是错误的】*

Gauss型求积公式考虑代权的求积公式：

$$
\int_a^b \rho(x)f(x)dx \approx \sum_{k=0}^n \mathbf{A}_kf(x_k)
$$

构成的充分必要条件为：求积节点是$n$次正交多项式的$n$个零点$x_i$

以PPT上的这道题为例:

>构造Gauss积分公式
>$$
>\int_0^1\ln\frac{1}{x}dx \approx \mathbf{A_1}f(x_1)+\mathbf{A_2}f(x_2)
>$$
>首先由于两个节点，构造正交二次多项式$\phi_2(x)=x^2+ax+b$与$1$和$x$正交：
><img src = Problem21.png width =500>
>求解$x_1$,$x_2$,使得：$\phi(x_1)=\phi(x_2)=0$:
><img src = Problem22.png width =320>
>最后求解得到最终的积分系数：
><img src = Problem23.png width =500>
>这样代回原式可以得到最终的解。

对于Gauss型求积公式有：

$$
\sum_{k=0}^n |\mathbf{A}_k| = \int_a^b \rho(x)dx = \text{常数}< K
$$

根据先前关于积分收敛性条件，其满足数值稳定性的要求。

虽然Gauss积分公式的构造复杂，但是收敛速度快，使用节点少，对于常用的Gauss积分公式，节点和系数已经被计算出来，只需要查表即可得到。

### 常见的Gauss求积公式

**1. Gauss-Chebyshev求积**

- 区间：[-1, 1]
- 权函数：$w(x) = \frac{1}{\sqrt{1-x^2}}$
- 节点$x_j$：
  $$
  x_j = \cos\frac{(2j+1)\pi}{2n+2}
  $$
- 系数$A_j$：
  $$
  A_j = \frac{\pi}{n+1}
  $$


**2. Gauss-Legendre求积**
- 区间：[-1, 1]
- 权函数：$w(x) = 1$
- 节点$x_j$：
  $n+1$次Legendre多项式 $P_{n+1}(x)$ 的零点
- 系数$A_j$：
  $$
  A_j = \frac{2}{(1-x_j^2) \left[ P'_{n+1}(x_j) \right]^2}
  $$


**3. Gauss-Hermite求积**
- 区间：$(-\infty, \infty)$
- 权函数：$w(x) = e^{-x^2}$
- 节点$x_j$：
  $n+1$次Hermite多项式$H_{n+1}(x)$的零点
- 系数$A_j$：
  $$
  A_j = \frac{2^{n+2} (n+1)! \sqrt{\pi}}{\left[ H_{n+1}'(x_j) \right]^2}
  $$


**4. Gauss-Laguerre求积**
- 区间：$[0, \infty)$
- 权函数：$w(x) = e^{-x}$
- 节点$x_j$：
  $n+1$次Laguerre多项式$L_{n+1}(x)$的零点
- 系数$A_j$：
  $$
  A_j = \frac{x_j}{\left[ (n+1)L_n(x_j) \right]^2}
  $$